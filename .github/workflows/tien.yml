name: Windows VPS 6h

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: T·∫£i & c·∫•u h√¨nh ngrok
        run: |
          Invoke-WebRequest https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-windows-amd64.zip -OutFile ngrok.zip
          Expand-Archive ngrok.zip
          .\ngrok\ngrok.exe config add-authtoken 29eh4vE8GamGOGE6YtQMlvLlZ4F_5LZpkhESEDUB7ZerGNCek

      - name: T·∫°o t√†i kho·∫£n RDP
        run: |
          net user tien123 123456 /add
          net localgroup administrators tien123 /add

      - name: M·ªü RDP port & b·∫≠t d·ªãch v·ª•
        run: |
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "UserAuthentication" -Value 1

      - name: Ch·∫°y ngrok TCP tunnel (background)
        run: |
          Start-Job { .\ngrok\ngrok.exe tcp 3389 }

      - name: ƒê·ª£i ngrok kh·ªüi ƒë·ªông
        run: Start-Sleep -Seconds 10

      - name: L·∫•y ƒë·ªãa ch·ªâ RDP t·ª´ ngrok
        run: |
          $tunnel = Invoke-RestMethod -Uri "http://127.0.0.1:4040/api/tunnels"
          $addr = $tunnel.tunnels.public_url -replace "tcp://",""
          echo "‚úÖ VPS ƒë√£ s·∫µn s√†ng!"
          echo "üåê K·∫øt n·ªëi RDP: $addr"
          echo "üë§ User: tien123"
          echo "üîë Pass: 123456"

      - name: Gi·ªØ VPS online 6h
        run: Start-Sleep -Seconds 21600
